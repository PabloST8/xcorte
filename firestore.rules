rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Permite leitura pública das empresas e seus dados
    match /enterprises/{enterpriseId} {
      allow read: if true;
      
      // Permite leitura pública dos serviços da empresa
      match /products/{productId} {
        allow read: if true;
      }
      
      // Permite leitura pública dos funcionários da empresa
      match /employees/{employeeId} {
        allow read: if true;
      }
      
      // Agendamentos requerem autenticação para leitura e escrita
      match /bookings/{bookingId} {
        allow read, write: if request.auth != null;
      }
      
      // Permite leitura de outros dados da empresa
      match /{document=**} {
        allow read: if true;
        allow write: if request.auth != null;
      }
    }
    
    // Permite leitura/escrita para usuários autenticados em suas próprias informações
    // TEMPORÁRIO: Permite criação de usuários sem autenticação para desenvolvimento
    match /users/{userId} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.uid == userId;
      allow create: if true; // Permite criação sem autenticação
    }
    
    // Permite acesso ao carrinho para usuários autenticados
    match /carts/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Permite acesso a carrinhos por usuário e empresa
    match /userCarts/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
      
      match /enterprises/{enterpriseId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }
    
    // Permite acesso a carrinhos por sessão (para usuários não autenticados)
    match /session_carts/{sessionId} {
      allow read, write: if true;
    }
    
    // Permite leitura/escrita para agendamentos do usuário
    match /appointments/{appointmentId} {
      allow read, write: if request.auth != null;
    }
    
    // Administradores podem acessar dados administrativos
    match /admin/{document=**} {
      allow read, write: if request.auth != null;
    }
    
    // Permite escrita/leitura em outras coleções para usuários autenticados
    match /{document=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }
  }
}
